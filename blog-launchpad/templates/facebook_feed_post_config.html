<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ platform.display_name }} {{ channel_type.display_name }} Configuration - Blog Launchpad</title>
    <!-- Tailwind CSS for header -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/launchpad.css') }}">
    <style>
        /* Channel config specific styles */
        .channel-header {
            background: linear-gradient(135deg, #1877f2 0%, #0d6efd 100%);
            color: white;
            padding: 2rem;
            border-radius: 16px;
            margin-bottom: 2rem;
        }
        
        .config-section {
            margin-bottom: 2rem;
        }
        
        .section-title {
            color: #e0e0e0;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .config-card {
            background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
            border: 1px solid #4a5568;
            border-radius: 12px;
            margin-bottom: 1rem;
        }
        
        .config-card.channel-specific {
            border-left: 6px solid #06b6d4;
        }
        
        .config-card.platform-wide {
            border-left: 6px solid #8b5cf6;
        }
        
        .card-header {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid #4a5568;
            padding: 1rem 1.5rem;
            border-radius: 12px 12px 0 0;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #4a5568;
        }
        
        .config-item:last-child {
            border-bottom: none;
        }
        
        .config-name {
            font-weight: 500;
            color: #e0e0e0;
        }
        
        .config-value {
            color: #a0aec0;
            font-family: monospace;
        }
        
        .config-description {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }
        
        /* Accordion Styles for Channel Requirements */
        .accordion-item.config-card {
            background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
            border: 1px solid #4a5568;
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        .accordion-button {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border: none;
            color: #e0e0e0;
            padding: 1.25rem;
            font-weight: 600;
            box-shadow: none;
        }
        
        .accordion-button:not(.collapsed) {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
            box-shadow: none;
        }
        
        .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(6, 182, 212, 0.25);
            border-color: #06b6d4;
        }
        
        .accordion-button::after {
            display: none;
        }
        
        .requirement-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .requirement-indicator .badge {
            font-size: 0.8rem;
            padding: 0.5rem 0.75rem;
        }
        
        .requirement-indicator .fa-chevron-down {
            transition: transform 0.3s ease;
        }
        
        .accordion-collapse {
            background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%);
        }
        
        .accordion-body {
            padding: 1.5rem;
            border-top: 1px solid #4a5568;
        }
        
        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .requirement-category {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 1.5rem;
        }
        
        .category-title {
            color: #e0e0e0;
            font-weight: 600;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #4a5568;
        }
        
        .requirement-category .config-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid #4a5568;
        }
        
        .requirement-category .config-item:last-child {
            border-bottom: none;
        }
        
        .breadcrumb-nav {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        .breadcrumb {
            display: flex;
            flex-wrap: wrap;
            padding: 0;
            margin: 0;
            list-style: none;
            background: transparent;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            color: #a0aec0;
        }
        
        .breadcrumb-item + .breadcrumb-item::before {
            content: ">";
            color: #6b7280;
            margin: 0 0.5rem;
        }
        
        .breadcrumb-item.active {
            color: #e0e0e0;
        }
        
        .breadcrumb-item a {
            color: #667eea;
            text-decoration: none;
        }
        
        .breadcrumb-item a:hover {
            color: #a5b4fc;
        }
        
        /* Accordion Styles for Blog Posts */
        .section-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            user-select: none;
            padding: 30px;
            margin: 0;
            transition: background-color 0.2s ease;
        }
        
        .section-title.with-right-content {
            justify-content: space-between;
        }
        
        .section-title-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section-title-right {
            display: flex;
            align-items: center;
            text-align: right;
        }
        
        .section-title:hover {
            background-color: #334155;
        }
        
        .section-content {
            padding: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, padding 0.3s ease-out;
        }
        
        .section-content.expanded {
            max-height: 2000px;
            padding: 0 30px 30px 30px;
        }
        
        .accordion-chevron {
            transition: transform 0.3s ease;
        }
        
        .accordion-chevron.expanded {
            transform: rotate(90deg);
        }
        
        /* Header Styles */
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .status-active {
            background: #10b981;
            color: white;
        }
        
        .status-limited {
            background: #f59e0b;
            color: white;
        }
        
        .status-draft {
            background: #6b7280;
            color: white;
        }
        
        .priority-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .priority-high {
            background: #dc2626;
            color: white;
        }
        
        .priority-medium {
            background: #ea580c;
            color: white;
        }
        
        .priority-low {
            background: #16a34a;
            color: white;
        }
        
        /* Header styling overrides for this page */
        .header-gradient {
            background: linear-gradient(90deg, #181c2a 0%, #23273a 100%) !important;
            border-bottom: 1px solid #31364a !important;
        }
        
        .header-gradient .nav-link {
            color: #e0e0e0 !important;
        }
        
        .header-gradient .nav-link:hover {
            color: #ffffff !important;
        }
        
        .header-gradient .dropdown-menu {
            background: #23273a !important;
            border: 1px solid #31364a !important;
            box-shadow: 0 4px 24px 0 rgba(0, 0, 0, 0.45) !important;
        }
        
        .header-gradient .dropdown-item {
            color: #e0e0e0 !important;
        }
        
        .header-gradient .dropdown-item:hover {
            background: #31364a !important;
            color: #ffffff !important;
        }
        
        /* Ensure header is above other content */
        .header-gradient {
            position: relative;
            z-index: 1000;
        }
        
        /* Body styling to match daily product posts */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            min-height: 100vh;
            color: #e0e0e0;
        }
        
        /* Container styling to match daily product posts */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Additional header-related classes */
        .nav-dropdown {
            background: #23273a;
            border: 1px solid #31364a;
            box-shadow: 0 4px 24px 0 rgba(0, 0, 0, 0.45);
        }
        .nav-dropdown a {
            color: #e0e0e0;
        }
        .nav-dropdown a:hover {
            background: #23273a;
            color: #a5b4fc;
        }
        .text-dark-text {
            color: #e0e0e0;
        }
        .text-dark-accent {
            color: #a5b4fc;
        }
        .hover\:text-dark-accent:hover {
            color: #a5b4fc;
        }
        .hover\:bg-dark-bg:hover {
            background: #23273a;
        }
        .bg-dark-accent {
            background: #a5b4fc;
        }
        .bg-dark-bg {
            background: #23273a;
        }
    </style>
</head>
<body>
    {% include 'shared/header.html' %}
    
    <div class="container">
        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-nav">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item">
                        <a href="/syndication"><i class="fas fa-home me-1"></i>Syndication</a>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="/syndication/dashboard"><i class="fab fa-{{ platform.name|lower }} me-1"></i>{{ platform.display_name }}</a>
                    </li>
                    <li class="breadcrumb-item active" aria-current="page">
                        <i class="fas fa-newspaper me-1"></i>{{ channel_type.display_name }} Configuration
                    </li>
                </ol>
            </nav>
        </div>
        
        <!-- Page Header -->
        <div class="header">
            <h1>ðŸ“° Blog Posts</h1>
            <p>Automated Facebook posts featuring blog content and articles</p>
        </div>
        
        <!-- Blog Post Management Accordions -->
        <!-- Item Selection Section -->
        <div class="section-card">
            <div class="section-title" onclick="toggleAccordion('item-selection')">
                <i class="fas fa-chevron-right accordion-chevron" id="item-selection-chevron"></i>
                <i class="fas fa-newspaper"></i>
                Item Selection
            </div>
            <div class="section-content" id="item-selection-content">
                <!-- Post Selection -->
                <div class="mb-4">
                    <label for="postSelector" class="form-label text-white">Choose a published post:</label>
                    <select class="form-select bg-dark text-white border-secondary" id="postSelector">
                        <option value="">Loading posts...</option>
                    </select>
                </div>
                
                <!-- Selected Post Details -->
                <div id="postDetails" class="d-none">
                    <hr class="border-secondary">
                    <h6 class="text-info mb-3">Post Details</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Title:</strong> <span id="postTitle"></span></p>
                            <p><strong>Created Date:</strong> <span id="postCreatedAt"></span></p>
                            <p><strong>Last Updated:</strong> <span id="postUpdatedAt"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Post ID:</strong> <span id="postId"></span></p>
                            <p><strong>Status:</strong> <span id="postStatus"></span></p>
                            <p><strong>Slug:</strong> <span id="postSlug"></span></p>
                            <p><strong>Number of Sections:</strong> <span id="postSectionCount"></span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Post Sections List -->
                <div id="sectionsList" class="d-none">
                    <hr class="border-secondary">
                    <h6 class="text-info mb-3">Post Sections</h6>
                    <div id="sectionsContainer">
                        <!-- Section titles will be populated here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Content Generation Section -->
        <div class="section-card">
            <div class="section-title" onclick="toggleAccordion('content-generation')">
                <i class="fas fa-chevron-right accordion-chevron" id="content-generation-chevron"></i>
                <i class="fas fa-robot"></i>
                AI Content Generation
            </div>
            <div class="section-content" id="content-generation-content">
                <div style="text-align: center; color: #94a3b8; padding: 40px 20px; font-style: italic;">
                    <i class="fas fa-robot" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                    AI content generation functionality will be implemented here
                </div>
            </div>
        </div>
        
        <!-- Posting Control Section -->
        <div class="section-card">
            <div class="section-title with-right-content" onclick="toggleAccordion('posting-control')">
                <div class="section-title-left">
                    <i class="fas fa-chevron-right accordion-chevron" id="posting-control-chevron"></i>
                    <i class="fas fa-paper-plane"></i>
                    Posting Control
                </div>
                <div class="section-title-right" id="next-posts-info" style="font-size: 0.9rem; color: #94a3b8;">
                    Loading...
                </div>
            </div>
            <div class="section-content" id="posting-control-content">
                <div style="text-align: center; color: #94a3b8; padding: 40px 20px; font-style: italic;">
                    <i class="fas fa-paper-plane" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                    Posting control functionality will be implemented here
                </div>
            </div>
        </div>
        
        <!-- Posting Queue Section -->
        <div class="section-card" data-accordion="posting-queue">
            <div class="section-title with-right-content" onclick="toggleAccordion('posting-queue')">
                <div class="section-title-left">
                    <i class="fas fa-chevron-right accordion-chevron" id="posting-queue-chevron"></i>
                    <i class="fas fa-list-alt"></i>
                    Posting Queue
                </div>
                <div class="section-title-right">
                    <span id="queue-count" class="badge" style="background: #f59e0b; color: #0f172a;">0</span>
                </div>
            </div>
            <div class="section-content" id="posting-queue-content">
                <div style="text-align: center; color: #94a3b8; padding: 40px 20px; font-style: italic;">
                    <i class="fas fa-list-alt" style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                    Posting queue functionality will be implemented here
                </div>
            </div>
        </div>
        
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        function toggleAccordion(sectionId) {
            const content = document.getElementById(sectionId + '-content');
            const chevron = document.getElementById(sectionId + '-chevron');
            
            if (content.classList.contains('expanded')) {
                // Collapse
                content.classList.remove('expanded');
                chevron.classList.remove('expanded');
            } else {
                // Expand
                content.classList.add('expanded');
                chevron.classList.add('expanded');
            }
        }

        // Automated Selection Functionality
        function loadNextSection() {
            const postSelector = document.getElementById('postSelector');
            const postDetails = document.getElementById('postDetails');
            const sectionsList = document.getElementById('sectionsList');
            
            // Show loading state
            postSelector.innerHTML = '<option value="">Loading next section...</option>';
            postDetails.classList.add('d-none');
            sectionsList.classList.add('d-none');
            
            // Get next unprocessed section for Facebook feed_post
            fetch('/api/syndication/next-section?platform_id=1&channel_type_id=1')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success' && data.next_section) {
                        const section = data.next_section;
                        
                        // Update post selector to show the selected post
                        postSelector.innerHTML = `<option value="${section.post_id}" selected>${section.post_title} (ID: ${section.post_id})</option>`;
                        
                        // Update post details
                        updatePostDetails({
                            id: section.post_id,
                            title: section.post_title,
                            created_at: section.post_created_at,
                            updated_at: section.post_created_at,
                            status: 'published',
                            slug: 'auto-selected',
                            section_count: 'Auto-selected'
                        });
                        
                        // Show the specific section
                        showSelectedSection(section);
                        
                        // Mark as processing
                        markSectionAsProcessing(section);
                        
                    } else {
                        // No unprocessed sections found
                        postSelector.innerHTML = '<option value="">No unprocessed sections found</option>';
                        showNoSectionsMessage();
                    }
                })
                .catch(error => {
                    console.error('Error loading next section:', error);
                    postSelector.innerHTML = '<option value="">Error loading next section</option>';
                });
        }
        
        function showSelectedSection(section) {
            const sectionsContainer = document.getElementById('sectionsContainer');
            const sectionsList = document.getElementById('sectionsList');
            
            sectionsContainer.innerHTML = `
                <div class="mb-2 p-3 bg-success border border-success rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <strong class="text-white">Section ${section.section_order}: ${section.section_heading || 'Untitled'}</strong>
                            <small class="text-white d-block">${section.section_description ? section.section_description.substring(0, 100) + '...' : 'No description'}</small>
                            <small class="text-white d-block">Status: <span class="badge bg-warning">${section.status}</span></small>
                        </div>
                        <div>
                            <span class="badge bg-info">${section.section_id}</span>
                        </div>
                    </div>
                </div>
            `;
            
            sectionsList.classList.remove('d-none');
        }
        
        function showNoSectionsMessage() {
            const sectionsContainer = document.getElementById('sectionsContainer');
            const sectionsList = document.getElementById('sectionsList');
            
            sectionsContainer.innerHTML = `
                <div class="text-center p-4">
                    <i class="fas fa-check-circle text-success" style="font-size: 3rem; margin-bottom: 1rem;"></i>
                    <h5 class="text-success">All Sections Processed!</h5>
                    <p class="text-muted">All available blog post sections have been processed for Facebook feed posts.</p>
                    <button class="btn btn-primary" onclick="loadNextSection()">
                        <i class="fas fa-refresh me-2"></i>Check for New Sections
                    </button>
                </div>
            `;
            
            sectionsList.classList.remove('d-none');
        }
        
        function markSectionAsProcessing(section) {
            fetch('/api/syndication/mark-processing', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    post_id: section.post_id,
                    section_id: section.section_id,
                    platform_id: section.platform_id,
                    channel_type_id: section.channel_type_id,
                    process_id: section.process_id
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('Section marked as processing');
                } else {
                    console.error('Failed to mark section as processing:', data.error);
                }
            })
            .catch(error => {
                console.error('Error marking section as processing:', error);
            });
        }
        
        function markSectionAsCompleted(section) {
            fetch('/api/syndication/mark-completed', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    post_id: section.post_id,
                    section_id: section.section_id,
                    platform_id: section.platform_id,
                    channel_type_id: section.channel_type_id,
                    process_id: section.process_id
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('Section marked as completed');
                    // Optionally reload to get next section
                    setTimeout(() => loadNextSection(), 2000);
                } else {
                    console.error('Failed to mark section as completed:', data.error);
                }
            })
            .catch(error => {
                console.error('Error marking section as completed:', error);
            });
        }
        
        function markSectionAsFailed(section, errorMessage) {
            fetch('/api/syndication/mark-failed', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    post_id: section.post_id,
                    section_id: section.section_id,
                    platform_id: section.platform_id,
                    channel_type_id: section.channel_type_id,
                    process_id: section.process_id,
                    error_message: errorMessage
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    console.log('Section marked as failed');
                } else {
                    console.error('Failed to mark section as failed:', data.error);
                }
            })
            .catch(error => {
                console.error('Error marking section as failed:', error);
            });
        }

        function loadPostSections(postId) {
            const sectionsContainer = document.getElementById('sectionsContainer');
            const sectionsList = document.getElementById('sectionsList');
            
            fetch(`/api/syndication/post-sections/${postId}`)
                .then(response => response.json())
                .then(data => {
                    sectionsContainer.innerHTML = '';
                    
                    if (data.sections && data.sections.length > 0) {
                        data.sections.forEach(section => {
                            const sectionDiv = document.createElement('div');
                            sectionDiv.className = 'mb-2 p-2 bg-dark border border-secondary rounded';
                            sectionDiv.innerHTML = `
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong class="text-white">Section ${section.order}: ${section.title || 'Untitled'}</strong>
                                        <small class="text-muted d-block">${section.content ? section.content.substring(0, 100) + '...' : 'No content'}</small>
                                    </div>
                                    <div>
                                        <span class="badge bg-info">${section.id}</span>
                                    </div>
                                </div>
                            `;
                            sectionsContainer.appendChild(sectionDiv);
                        });
                        sectionsList.classList.remove('d-none');
                    } else {
                        sectionsContainer.innerHTML = '<p class="text-muted">No sections found for this post.</p>';
                        sectionsList.classList.remove('d-none');
                    }
                })
                .catch(error => {
                    console.error('Error loading sections:', error);
                    sectionsContainer.innerHTML = '<p class="text-danger">Error loading sections</p>';
                    sectionsList.classList.remove('d-none');
                });
        }

        function updatePostDetails(post) {
            document.getElementById('postTitle').textContent = post.title;
            document.getElementById('postCreatedAt').textContent = new Date(post.created_at).toLocaleDateString();
            document.getElementById('postUpdatedAt').textContent = new Date(post.updated_at).toLocaleDateString();
            document.getElementById('postId').textContent = post.id;
            document.getElementById('postStatus').textContent = post.status;
            document.getElementById('postSlug').textContent = post.slug;
            document.getElementById('postSectionCount').textContent = post.section_count || 'Unknown';
            
            document.getElementById('postDetails').classList.remove('d-none');
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load next unprocessed section automatically
            loadNextSection();
            
            // Add refresh button functionality
            const refreshButton = document.createElement('button');
            refreshButton.className = 'btn btn-sm btn-outline-primary ms-2';
            refreshButton.innerHTML = '<i class="fas fa-refresh me-1"></i>Refresh';
            refreshButton.onclick = loadNextSection;
            
            // Add refresh button to the post selector area
            const postSelectorContainer = document.querySelector('label[for="postSelector"]').parentElement;
            postSelectorContainer.appendChild(refreshButton);
        });
    </script>
</body>
</html>
