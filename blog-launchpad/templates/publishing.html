<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publishing Management - Blog Launchpad</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .publishing-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .post-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: box-shadow 0.2s;
        }
        .post-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .status-badge {
            font-size: 0.85rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            font-weight: 500;
        }
        .status-not-published {
            background-color: #f8f9fa;
            color: #6c757d;
            border: 1px solid #dee2e6;
        }
        .status-published {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-publishing {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .publish-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            border: none;
            color: white;
            padding: 0.5rem 1.5rem;
            border-radius: 25px;
            transition: all 0.3s;
        }
        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
            color: white;
        }
        .publish-btn:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
        }
        .retry-btn {
            background: linear-gradient(135deg, #ff9500 0%, #ff8c00 100%);
            border: none;
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .view-btn {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            border: none;
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
        }
        .stats-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 1rem;
        }
        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
        .clan-logo {
            height: 24px;
            margin-right: 8px;
        }
        .publishing-log {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 200px;
            overflow-y: auto;
            border-left: 4px solid #667eea;
        }
        .error-details {
            background: #fff5f5;
            border: 1px solid #fed7d7;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 0.5rem;
            font-size: 0.9rem;
        }
        .success-message {
            background: #f0fff4;
            border: 1px solid #9ae6b4;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 0.5rem;
            color: #22543d;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-rocket me-2"></i>Blog Launchpad
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">Dashboard</a>
                <a class="nav-link" href="/cross-promotion">Cross Promotion</a>
                <a class="nav-link active" href="/publishing">Publishing</a>
                <a class="nav-link" href="/test-api">API Test</a>
            </div>
        </div>
    </nav>

    <!-- Publishing Header -->
    <div class="publishing-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">
                        <i class="fas fa-share-alt me-3"></i>Publishing Management
                    </h1>
                    <p class="mb-0 opacity-75">Manage and monitor blog post publishing to Clan.com</p>
                </div>
                <div class="col-md-4 text-end">
                    <img src="https://www.clan.com/skin/frontend/default/clan/images/logo.png" alt="Clan.com" class="clan-logo">
                    <span class="fs-5">â†’ Clan.com</span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Publishing Statistics -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number" id="total-posts">12</div>
                    <div class="text-muted">Total Posts</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-success" id="published-posts">8</div>
                    <div class="text-muted">Published</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-warning" id="pending-posts">3</div>
                    <div class="text-muted">Not Published</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <div class="stats-number text-danger" id="error-posts">1</div>
                    <div class="text-muted">Errors</div>
                </div>
            </div>
        </div>

        <!-- Bulk Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">
                            <i class="fas fa-tasks me-2"></i>Bulk Actions
                        </h5>
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="select-all">
                                    <label class="form-check-label" for="select-all">Select All</label>
                                </div>
                                <span class="text-muted ms-3">
                                    <span id="selected-count">0</span> posts selected
                                </span>
                            </div>
                            <div class="col-md-6 text-end">
                                <button class="btn btn-outline-primary me-2" id="bulk-publish" disabled>
                                    <i class="fas fa-upload me-2"></i>Publish Selected
                                </button>
                                <button class="btn btn-outline-secondary" id="bulk-sync" disabled>
                                    <i class="fas fa-sync me-2"></i>Sync Status
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Posts List -->
        <div class="row">
            <div class="col-12">
                <h3 class="mb-3">
                    <i class="fas fa-list me-2"></i>Posts
                    <button class="btn btn-outline-primary btn-sm ms-3" onclick="refreshPosts()">
                        <i class="fas fa-refresh me-1"></i>Refresh
                    </button>
                </h3>

                <!-- Post Card - Example 1: Not Published -->
                <div class="post-card" data-post-id="1">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <input class="form-check-input post-checkbox" type="checkbox" value="1">
                        </div>
                        <div class="col-md-5">
                            <h5 class="mb-1">The Evolution of Scottish Kilts</h5>
                            <p class="text-muted mb-1">
                                <small>
                                    <i class="fas fa-calendar me-1"></i>Created: Jan 15, 2025
                                    <i class="fas fa-edit ms-3 me-1"></i>Updated: Jan 20, 2025
                                </small>
                            </p>
                            <div class="mb-2">
                                <span class="badge bg-secondary me-1">History</span>
                                <span class="badge bg-secondary me-1">Tartan</span>
                                <span class="badge bg-secondary">Scottish</span>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <span class="status-badge status-not-published">
                                <i class="fas fa-clock me-1"></i>Not Published
                            </span>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="text-muted">
                                <small>Clan.com ID: --</small>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <button class="btn publish-btn me-2" onclick="publishPost(1)">
                                <i class="fas fa-upload me-1"></i>Publish
                            </button>
                            <button class="btn view-btn" onclick="previewPost(1)">
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Post Card - Example 2: Published -->
                <div class="post-card" data-post-id="2">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <input class="form-check-input post-checkbox" type="checkbox" value="2">
                        </div>
                        <div class="col-md-5">
                            <h5 class="mb-1">Clan Stewart's Highland Heritage</h5>
                            <p class="text-muted mb-1">
                                <small>
                                    <i class="fas fa-calendar me-1"></i>Created: Jan 10, 2025
                                    <i class="fas fa-edit ms-3 me-1"></i>Updated: Jan 18, 2025
                                </small>
                            </p>
                            <div class="mb-2">
                                <span class="badge bg-secondary me-1">Clans</span>
                                <span class="badge bg-secondary me-1">Heritage</span>
                                <span class="badge bg-secondary">Scotland</span>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <span class="status-badge status-published">
                                <i class="fas fa-check me-1"></i>Published
                            </span>
                            <div class="success-message mt-2">
                                <small>
                                    <i class="fas fa-check-circle me-1"></i>
                                    Published successfully on Jan 18, 2025
                                </small>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="text-success">
                                <small>
                                    <strong>Clan.com ID: 12847</strong><br>
                                    <a href="https://clan.com/blog/clan-stewart-highland-heritage" target="_blank" class="text-decoration-none">
                                        <i class="fas fa-external-link-alt me-1"></i>View Live
                                    </a>
                                </small>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <button class="btn publish-btn me-2" onclick="republishPost(2)">
                                <i class="fas fa-sync me-1"></i>Update
                            </button>
                            <button class="btn view-btn" onclick="previewPost(2)">
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Post Card - Example 3: Error -->
                <div class="post-card" data-post-id="3">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <input class="form-check-input post-checkbox" type="checkbox" value="3">
                        </div>
                        <div class="col-md-5">
                            <h5 class="mb-1">Traditional Tartan Weaving Techniques</h5>
                            <p class="text-muted mb-1">
                                <small>
                                    <i class="fas fa-calendar me-1"></i>Created: Jan 12, 2025
                                    <i class="fas fa-edit ms-3 me-1"></i>Updated: Jan 19, 2025
                                </small>
                            </p>
                            <div class="mb-2">
                                <span class="badge bg-secondary me-1">Crafts</span>
                                <span class="badge bg-secondary me-1">Tartan</span>
                                <span class="badge bg-secondary">Weaving</span>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <span class="status-badge status-error">
                                <i class="fas fa-exclamation-triangle me-1"></i>Error
                            </span>
                            <div class="error-details mt-2">
                                <small>
                                    <strong>Last attempt:</strong> Jan 19, 2025 14:30<br>
                                    <strong>Error:</strong> Image upload failed - file not found
                                </small>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="text-muted">
                                <small>Clan.com ID: --</small>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <button class="btn retry-btn me-2" onclick="retryPublish(3)">
                                <i class="fas fa-redo me-1"></i>Retry
                            </button>
                            <button class="btn view-btn" onclick="previewPost(3)">
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Post Card - Example 4: Publishing (In Progress) -->
                <div class="post-card" data-post-id="4">
                    <div class="row align-items-center">
                        <div class="col-md-1">
                            <input class="form-check-input post-checkbox" type="checkbox" value="4" disabled>
                        </div>
                        <div class="col-md-5">
                            <h5 class="mb-1">Modern Celtic Fashion Trends</h5>
                            <p class="text-muted mb-1">
                                <small>
                                    <i class="fas fa-calendar me-1"></i>Created: Jan 16, 2025
                                    <i class="fas fa-edit ms-3 me-1"></i>Updated: Jan 20, 2025
                                </small>
                            </p>
                            <div class="mb-2">
                                <span class="badge bg-secondary me-1">Fashion</span>
                                <span class="badge bg-secondary me-1">Modern</span>
                                <span class="badge bg-secondary">Celtic</span>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <span class="status-badge status-publishing">
                                <i class="fas fa-spinner fa-spin me-1"></i>Publishing...
                            </span>
                            <div class="publishing-log mt-2">
                                <div>2025-01-20 15:45:12 - Starting publish process...</div>
                                <div>2025-01-20 15:45:15 - Uploading header image...</div>
                                <div>2025-01-20 15:45:18 - Uploading section images (2/3)...</div>
                                <div>2025-01-20 15:45:21 - Processing content...</div>
                            </div>
                        </div>
                        <div class="col-md-2 text-center">
                            <div class="text-muted">
                                <small>Clan.com ID: --</small>
                            </div>
                        </div>
                        <div class="col-md-2 text-end">
                            <button class="btn publish-btn me-2" disabled>
                                <i class="fas fa-spinner fa-spin me-1"></i>Publishing...
                            </button>
                            <button class="btn view-btn" onclick="previewPost(4)">
                                <i class="fas fa-eye me-1"></i>Preview
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Log -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-history me-2"></i>Recent Publishing Activity
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="publishing-log" style="max-height: 300px;">
                            <div>[2025-01-20 15:45:21] <span class="text-primary">INFO</span> - Post #4 "Modern Celtic Fashion Trends" - Processing content...</div>
                            <div>[2025-01-20 15:45:18] <span class="text-primary">INFO</span> - Post #4 "Modern Celtic Fashion Trends" - Uploading section images (2/3)...</div>
                            <div>[2025-01-20 15:45:15] <span class="text-primary">INFO</span> - Post #4 "Modern Celtic Fashion Trends" - Uploading header image...</div>
                            <div>[2025-01-20 15:45:12] <span class="text-primary">INFO</span> - Post #4 "Modern Celtic Fashion Trends" - Starting publish process...</div>
                            <div>[2025-01-20 14:32:45] <span class="text-success">SUCCESS</span> - Post #2 "Clan Stewart's Highland Heritage" - Published successfully (Clan.com ID: 12847)</div>
                            <div>[2025-01-20 14:32:42] <span class="text-primary">INFO</span> - Post #2 "Clan Stewart's Highland Heritage" - Calling Clan.com API...</div>
                            <div>[2025-01-20 14:32:38] <span class="text-primary">INFO</span> - Post #2 "Clan Stewart's Highland Heritage" - All images uploaded successfully</div>
                            <div>[2025-01-20 14:30:15] <span class="text-danger">ERROR</span> - Post #3 "Traditional Tartan Weaving Techniques" - Image upload failed: file not found</div>
                            <div>[2025-01-20 14:30:10] <span class="text-primary">INFO</span> - Post #3 "Traditional Tartan Weaving Techniques" - Starting publish process...</div>
                            <div>[2025-01-20 11:15:33] <span class="text-success">SUCCESS</span> - Post #1 "The Evolution of Scottish Kilts" - Published successfully (Clan.com ID: 12846)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Mock data for demonstration
        let posts = [
            {id: 1, title: "The Evolution of Scottish Kilts", status: "not_published", clan_id: null},
            {id: 2, title: "Clan Stewart's Highland Heritage", status: "published", clan_id: 12847},
            {id: 3, title: "Traditional Tartan Weaving Techniques", status: "error", clan_id: null},
            {id: 4, title: "Modern Celtic Fashion Trends", status: "publishing", clan_id: null}
        ];

        // Publishing functions
        function publishPost(postId) {
            console.log('Publishing post:', postId);
            showToast('Publishing post to Clan.com...', 'info');
            
            // Mock API call
            setTimeout(() => {
                showToast('Post published successfully!', 'success');
                // Update UI status
                updatePostStatus(postId, 'published');
            }, 3000);
        }

        function republishPost(postId) {
            console.log('Republishing post:', postId);
            showToast('Updating post on Clan.com...', 'info');
            
            // Mock API call
            setTimeout(() => {
                showToast('Post updated successfully!', 'success');
            }, 2000);
        }

        function retryPublish(postId) {
            console.log('Retrying publish for post:', postId);
            showToast('Retrying publish to Clan.com...', 'info');
            
            // Mock API call
            setTimeout(() => {
                showToast('Retry successful! Post published.', 'success');
                updatePostStatus(postId, 'published');
            }, 2500);
        }

        function previewPost(postId) {
            console.log('Previewing post:', postId);
            window.open(`/preview/${postId}`, '_blank');
        }

        function updatePostStatus(postId, newStatus) {
            // Update the status badge for the post
            const postCard = document.querySelector(`[data-post-id="${postId}"]`);
            if (postCard) {
                const statusBadge = postCard.querySelector('.status-badge');
                statusBadge.className = `status-badge status-${newStatus}`;
                
                if (newStatus === 'published') {
                    statusBadge.innerHTML = '<i class="fas fa-check me-1"></i>Published';
                } else if (newStatus === 'error') {
                    statusBadge.innerHTML = '<i class="fas fa-exclamation-triangle me-1"></i>Error';
                } else if (newStatus === 'publishing') {
                    statusBadge.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Publishing...';
                }
            }
        }

        function refreshPosts() {
            showToast('Refreshing posts...', 'info');
            // Mock refresh
            setTimeout(() => {
                showToast('Posts refreshed successfully!', 'success');
            }, 1000);
        }

        // Checkbox handling
        document.getElementById('select-all').addEventListener('change', function() {
            const checkboxes = document.querySelectorAll('.post-checkbox:not([disabled])');
            checkboxes.forEach(cb => cb.checked = this.checked);
            updateSelectionCount();
        });

        document.querySelectorAll('.post-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', updateSelectionCount);
        });

        function updateSelectionCount() {
            const selectedCount = document.querySelectorAll('.post-checkbox:checked').length;
            document.getElementById('selected-count').textContent = selectedCount;
            
            const bulkButtons = document.querySelectorAll('#bulk-publish, #bulk-sync');
            bulkButtons.forEach(btn => btn.disabled = selectedCount === 0);
        }

        // Bulk actions
        document.getElementById('bulk-publish').addEventListener('click', function() {
            const selectedPosts = Array.from(document.querySelectorAll('.post-checkbox:checked'))
                .map(cb => cb.value);
            console.log('Bulk publishing posts:', selectedPosts);
            showToast(`Publishing ${selectedPosts.length} posts to Clan.com...`, 'info');
        });

        document.getElementById('bulk-sync').addEventListener('click', function() {
            const selectedPosts = Array.from(document.querySelectorAll('.post-checkbox:checked'))
                .map(cb => cb.value);
            console.log('Bulk syncing posts:', selectedPosts);
            showToast(`Syncing status for ${selectedPosts.length} posts...`, 'info');
        });

        // Toast notification system
        function showToast(message, type = 'info') {
            const toastContainer = getOrCreateToastContainer();
            
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'primary'} border-0`;
            toast.setAttribute('role', 'alert');
            
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
            
            // Remove toast element after it's hidden
            toast.addEventListener('hidden.bs.toast', () => {
                toast.remove();
            });
        }

        function getOrCreateToastContainer() {
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container position-fixed bottom-0 end-0 p-3';
                container.style.zIndex = '9999';
                document.body.appendChild(container);
            }
            return container;
        }

        // Initialize selection count
        updateSelectionCount();
    </script>
</body>
</html>
