<!-- Outputs Accordion -->
<div class="accordion-item">
    <button
        class="accordion-header w-full flex justify-between items-center p-4 bg-dark-bg hover:bg-dark-hover focus:outline-none"
        onclick="toggleAccordion('outputs')">
        <span class="font-medium text-dark-text">Outputs TEST MARKER 2</span>
        <span class="text-gray-400 flex-grow text-left ml-4" id="outputs-summary">
            {% if step_config.outputs %}
            {% set ns = namespace(summary='') %}
            {% for output_id, output_config in step_config.outputs.items() %}
            {% set val = output_values[output_id] if output_values and output_id in output_values else 'â€”' %}
            {% if not loop.first %}{% set ns.summary = ns.summary + ', ' %}{% endif %}
            {% set first_line = val.split('\n')[0] if val else '' %}
            {% set ns.summary = ns.summary + first_line[:100] + ('...' if first_line|length > 100 else '') %}
            {% endfor %}
            {{ ns.summary }}
            {% else %}
            No outputs configured
            {% endif %}
        </span>
        <svg class="w-5 h-5 transform transition-transform accordion-icon" id="outputs-icon" fill="none"
            stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
    </button>
    <div id="outputs-content" class="hidden p-4 bg-dark-bg text-dark-text border-t border-dark-border">
        {% if step_config.outputs %}
        {% for output_id, output_config in step_config.outputs.items() %}
        <div class="mb-4">
            <label for="{{ output_id }}_output" class="block text-sm font-medium text-blue-500 mb-2">
                {{ output_config.label|default('Output Field') }}
            </label>
            <select class="field-selector bg-dark-bg text-dark-text border border-dark-border rounded p-2 w-full mb-2"
                data-target="{{ output_id }}_output" data-section="outputs"
                data-current-substage="{{ current_substage }}">
                <!-- Options will be populated by JavaScript -->
            </select>
            {% set val = output_values[output_id] if output_values and output_id in output_values else '' %}
            <textarea id="{{ output_id }}_output" name="{{ output_id }}"
                class="w-full bg-dark-bg border border-dark-border text-dark-text rounded p-4"
                data-db-field="{{ output_config.db_field }}" data-db-table="{{ output_config.db_table }}" rows="4"
                placeholder="{{ output_config.placeholder|default('Enter text...') }}">{{ val }}</textarea>
        </div>
        {% endfor %}
        {% else %}
        <p class="text-gray-400">No outputs configured for this step.</p>
        {% endif %}
    </div>
</div>

<!-- Outputs Accordion TEST MARKER 2 -->