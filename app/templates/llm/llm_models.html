{% extends "base.html" %}

{% block title %}LLM Models{% endblock %}

{% block area_nav %}
{% include 'llm/_llm_nav.html' %}
{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-10">
    <div class="admin-card">
        <div class="flex items-center justify-between mb-6">
            <h1 class="admin-title">
                <i class="fas fa-cubes mr-2"></i>
                LLM Models
            </h1>
            <a href="/llm/" class="btn btn-secondary">Back to LLM Dashboard</a>
        </div>
        <div class="mb-4">
            <button id="reloadModelsBtn" class="btn btn-primary"><i class="fas fa-sync"></i> Reload Models</button>
        </div>
        <div class="bg-dark-card rounded-xl p-6 shadow mb-8 overflow-x-auto">
            <table class="min-w-full text-left" id="modelsTable">
                <thead>
                    <tr class="text-indigo-200 border-b border-dark-border">
                        <th class="py-2 px-3">Model</th>
                        <th class="py-2 px-3">Provider</th>
                    </tr>
                </thead>
                <tbody id="modelsTableBody">
                    <tr>
                        <td colspan="3" class="text-center text-gray-400">Loading...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
<script>
    async function loadModels() {
        const tbody = document.getElementById('modelsTableBody');
        tbody.innerHTML = '<tr><td colspan="3" class="text-center text-gray-400">Loading...</td></tr>';
        try {
            // Fetch providers and models in parallel
            const [providersResp, modelsResp] = await Promise.all([
                fetch('/api/v1/llm/providers'),
                fetch('/api/v1/llm/models')
            ]);
            const providers = await providersResp.json();
            const models = await modelsResp.json();
            if (!Array.isArray(models) || models.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center text-gray-400">No models found.</td></tr>';
                return;
            }
            // Group models by provider_id
            const grouped = {};
            for (const m of models) {
                if (!grouped[m.provider_id]) grouped[m.provider_id] = [];
                grouped[m.provider_id].push(m);
            }
            tbody.innerHTML = '';
            for (const provider of providers) {
                const modelsForProvider = grouped[provider.id] || [];
                if (modelsForProvider.length === 0) continue;
                tbody.innerHTML += `<tr><td colspan="3" class="font-bold text-indigo-300 pt-6 pb-2 text-lg">${provider.name}</td></tr>`;
                for (const m of modelsForProvider) {
                    tbody.innerHTML += `<tr>
                        <td class="py-2 px-3 font-semibold text-white">${m.name}</td>
                        <td class="py-2 px-3">${provider.name}</td>
                        <td class="py-2 px-3 text-gray-400">${m.description || ''}</td>
                    </tr>`;
                }
            }
        } catch (e) {
            tbody.innerHTML = '<tr><td colspan="3" class="text-center text-red-400">Error loading models.</td></tr>';
        }
    }
    document.getElementById('reloadModelsBtn').onclick = loadModels;
    document.addEventListener('DOMContentLoaded', loadModels);
</script>
{% endblock %}