{% extends "base.html" %}

{% block title %}Settings - Field Mapping{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-8 bg-dark-bg border border-dark-border rounded-xl shadow-lg p-8">
    <h1 class="text-2xl font-bold text-white mb-2 flex items-center gap-2">
        <i class="fa-solid fa-gear text-indigo-400"></i> Settings: Workflow Field Mapping
    </h1>
    <p class="text-dark-text mb-6">
        View the current field mappings for each workflow step. These mappings are stored in the step configurations and
        determine which database fields are used for inputs and outputs in the workflow UI.
    </p>

    <div class="space-y-8">
        {% for stage in stages %}
        <div class="bg-[#1a1d2d] rounded-lg border border-dark-border overflow-hidden">
            <!-- Stage Header -->
            <div class="bg-[#23273a] p-4 flex items-center gap-3">
                <i class="fa-solid fa-layer-group text-indigo-400 text-lg"></i>
                <h2 class="text-xl font-semibold text-white">{{ stage.name }}</h2>
            </div>

            <!-- Stage Content -->
            <div class="p-6 space-y-6">
                {% for substage in substages if substage.stage_id == stage.id %}
                <div class="bg-[#23273a] rounded-lg border border-dark-border overflow-hidden">
                    <!-- Substage Header -->
                    <div class="bg-[#2a2f47] p-3 flex items-center gap-2">
                        <i class="fa-solid fa-folder text-indigo-300"></i>
                        <h3 class="text-lg font-medium text-white">{{ substage.substage_name }}</h3>
                    </div>

                    <!-- Substage Content -->
                    <div class="divide-y divide-dark-border">
                        {% for step in steps if step.substage_id == substage.substage_id %}
                        <div class="p-4">
                            <div class="flex items-center gap-2 mb-3">
                                <i class="fa-solid fa-file-lines text-indigo-200"></i>
                                <h4 class="text-md font-medium text-white">{{ step.name }}</h4>
                            </div>

                            {% if step.config %}
                            <div class="grid grid-cols-2 gap-4">
                                <!-- Input Fields -->
                                <div class="bg-[#1a1d2d] rounded p-3">
                                    <h5 class="text-sm font-medium text-indigo-300 mb-2 flex items-center gap-1">
                                        <i class="fa-solid fa-arrow-right-to-bracket"></i> Input Fields
                                    </h5>
                                    {% if step.config.inputs %}
                                    <ul class="space-y-2">
                                        {% for field_name, field_config in step.config.inputs.items() %}
                                        <li class="text-dark-text">
                                            <span class="text-indigo-200">{{ field_name }}:</span> {{
                                            field_config.db_field }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% else %}
                                    <p class="text-dark-text text-sm italic">No input fields configured</p>
                                    {% endif %}
                                </div>

                                <!-- Output Fields -->
                                <div class="bg-[#1a1d2d] rounded p-3">
                                    <h5 class="text-sm font-medium text-indigo-300 mb-2 flex items-center gap-1">
                                        <i class="fa-solid fa-arrow-right-from-bracket"></i> Output Fields
                                    </h5>
                                    {% if step.config.outputs %}
                                    <ul class="space-y-2">
                                        {% for field_name, field_config in step.config.outputs.items() %}
                                        <li class="text-dark-text">
                                            <span class="text-indigo-200">{{ field_name }}:</span> {{
                                            field_config.db_field }}
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% else %}
                                    <p class="text-dark-text text-sm italic">No output fields configured</p>
                                    {% endif %}
                                </div>
                            </div>
                            {% else %}
                            <p class="text-dark-text text-sm italic">No field mappings configured</p>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}