{% extends "blog/post_base.html" %}

{% block post_content %}
<div class="code-view">
    <!-- Header Content -->
    <div class="accordion mb-4" id="headerAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headerHeader">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                    data-bs-target="#headerCollapse">
                    Header Content
                </button>
            </h2>
            <div id="headerCollapse" class="accordion-collapse collapse show" data-bs-parent="#headerAccordion">
                <div class="accordion-body">
                    <div class="code-grid">
                        <div class="code-row">
                            <div class="code-label">title</div>
                            <div class="code-value">{{ post.title }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">summary</div>
                            <div class="code-value">{{ post.summary }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">author</div>
                            <div class="code-value">
                                {% if post.author %}
                                {{ post.author.username }} ({{ post.author.email }})
                                {% else %}
                                <span class="text-muted">None</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">categories</div>
                            <div class="code-value">
                                {% if post.categories %}
                                <ul class="list-unstyled mb-0">
                                    {% for category in post.categories %}
                                    <li>{{ category.name }}</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <span class="text-muted">None</span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">tags</div>
                            <div class="code-value">
                                {% if post.tags %}
                                <ul class="list-unstyled mb-0">
                                    {% for tag in post.tags %}
                                    <li>{{ tag.name }}</li>
                                    {% endfor %}
                                </ul>
                                {% else %}
                                <span class="text-muted">None</span>
                                {% endif %}
                            </div>
                        </div>
                        {% if post.header_image %}
                        <div class="code-row">
                            <div class="code-label">header_image</div>
                            <div class="code-value">
                                <div>{{ post.header_image.filename }}</div>
                                <small class="text-muted">{{ post.header_image.path }}</small>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Meta Information -->
    <div class="accordion mb-4" id="metaAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="metaHeader">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#metaCollapse">
                    Meta Information
                </button>
            </h2>
            <div id="metaCollapse" class="accordion-collapse collapse" data-bs-parent="#metaAccordion">
                <div class="accordion-body">
                    <div class="code-grid">
                        <div class="code-row">
                            <div class="code-label">id</div>
                            <div class="code-value">{{ post.id }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">slug</div>
                            <div class="code-value">{{ post.slug }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">published</div>
                            <div class="code-value">{{ post.published }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">created_at</div>
                            <div class="code-value">{{ post.created_at.isoformat() if post.created_at }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">updated_at</div>
                            <div class="code-value">{{ post.updated_at.isoformat() if post.updated_at }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">published_at</div>
                            <div class="code-value">{{ post.published_at.isoformat() if post.published_at }}</div>
                        </div>
                        <div class="code-row">
                            <div class="code-label">reading_time</div>
                            <div class="code-value">{{ post.reading_time }} minutes</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sections -->
    {% if post.sections %}
    <div class="accordion mb-4" id="sectionsAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="sectionsHeader">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#sectionsCollapse">
                    Sections ({{ post.sections|length }})
                </button>
            </h2>
            <div id="sectionsCollapse" class="accordion-collapse collapse" data-bs-parent="#sectionsAccordion">
                <div class="accordion-body">
                    {% for section in post.sections %}
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">Section {{ loop.index }}</h5>
                            <span class="badge bg-secondary">{{ section.content_type }}</span>
                        </div>
                        <div class="card-body">
                            <div class="code-grid">
                                <div class="code-row">
                                    <div class="code-label">title</div>
                                    <div class="code-value">{{ section.title }}</div>
                                </div>
                                <div class="code-row">
                                    <div class="code-label">subtitle</div>
                                    <div class="code-value">{{ section.subtitle }}</div>
                                </div>
                                <div class="code-row">
                                    <div class="code-label">content</div>
                                    <div class="code-value">
                                        <pre class="mb-0"><code>{{ section.content }}</code></pre>
                                    </div>
                                </div>
                                {% if section.image %}
                                <div class="code-row">
                                    <div class="code-label">image</div>
                                    <div class="code-value">{{ section.image.filename }}</div>
                                </div>
                                {% endif %}
                                {% if section.video_url %}
                                <div class="code-row">
                                    <div class="code-label">video_url</div>
                                    <div class="code-value">{{ section.video_url }}</div>
                                </div>
                                {% endif %}
                                {% if section.audio_url %}
                                <div class="code-row">
                                    <div class="code-label">audio_url</div>
                                    <div class="code-value">{{ section.audio_url }}</div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Additional Metadata -->
    <div class="accordion mb-4" id="additionalAccordion">
        <div class="accordion-item">
            <h2 class="accordion-header" id="additionalHeader">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#additionalCollapse">
                    Additional Metadata
                </button>
            </h2>
            <div id="additionalCollapse" class="accordion-collapse collapse" data-bs-parent="#additionalAccordion">
                <div class="accordion-body">
                    <div class="code-grid">
                        {% if post.workflow_status %}
                        <div class="code-row">
                            <div class="code-label">workflow_status</div>
                            <div class="code-value">{{ post.workflow_status.current_stage.value }}</div>
                        </div>
                        {% endif %}
                        {% if post.clan_com_post_id %}
                        <div class="code-row">
                            <div class="code-label">clan_com_post_id</div>
                            <div class="code-value">{{ post.clan_com_post_id }}</div>
                        </div>
                        {% endif %}
                        {% if post.llm_metadata %}
                        <div class="code-row">
                            <div class="code-label">llm_metadata</div>
                            <div class="code-value">
                                <pre class="mb-0"><code>{{ post.llm_metadata | tojson(indent=2) }}</code></pre>
                            </div>
                        </div>
                        {% endif %}
                        {% if post.syndication_status %}
                        <div class="code-row">
                            <div class="code-label">syndication_status</div>
                            <div class="code-value">
                                <pre class="mb-0"><code>{{ post.syndication_status | tojson(indent=2) }}</code></pre>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .code-grid {
        display: grid;
        gap: 0.5rem;
    }

    .code-row {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 1rem;
        padding: 0.5rem;
        border-bottom: 1px solid #eee;
    }

    .code-row:last-child {
        border-bottom: none;
    }

    .code-label {
        font-family: monospace;
        font-weight: bold;
        color: #666;
    }

    .code-value {
        font-family: monospace;
        white-space: pre-wrap;
        word-break: break-word;
    }

    .code-value pre {
        margin: 0;
        padding: 0.5rem;
        background: #f8f9fa;
        border-radius: 4px;
    }

    .code-value ul {
        margin: 0;
        padding: 0;
        list-style: none;
    }
</style>
{% endblock %}