{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Edit Section SQL</h1>

    <!-- Current Section Data -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="card-title mb-0">Current Section Data</h5>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">ID</dt>
                <dd class="col-sm-9">{{ section.id }}</dd>

                <dt class="col-sm-3">Post ID</dt>
                <dd class="col-sm-9">{{ section.post_id }}</dd>

                <dt class="col-sm-3">Title</dt>
                <dd class="col-sm-9">{{ section.title }}</dd>

                <dt class="col-sm-3">Subtitle</dt>
                <dd class="col-sm-9">{{ section.subtitle }}</dd>

                <dt class="col-sm-3">Content</dt>
                <dd class="col-sm-9">
                    <pre class="bg-light p-2 rounded"><code>{{ section.content }}</code></pre>
                </dd>

                <dt class="col-sm-3">Position</dt>
                <dd class="col-sm-9">{{ section.position }}</dd>

                <dt class="col-sm-3">Image ID</dt>
                <dd class="col-sm-9">{{ section.image_id }}</dd>

                <dt class="col-sm-3">Video URL</dt>
                <dd class="col-sm-9">{{ section.video_url }}</dd>

                <dt class="col-sm-3">Audio URL</dt>
                <dd class="col-sm-9">{{ section.audio_url }}</dd>

                <dt class="col-sm-3">Content Type</dt>
                <dd class="col-sm-9">{{ section.content_type }}</dd>

                <dt class="col-sm-3">Duration</dt>
                <dd class="col-sm-9">{{ section.duration }}</dd>

                <dt class="col-sm-3">Keywords</dt>
                <dd class="col-sm-9">{{ section.keywords }}</dd>

                <dt class="col-sm-3">Social Media Snippets</dt>
                <dd class="col-sm-9">
                    <pre
                        class="bg-light p-2 rounded"><code>{{ section.social_media_snippets | tojson(indent=2) if section.social_media_snippets else 'null' }}</code></pre>
                </dd>

                <dt class="col-sm-3">Section Metadata</dt>
                <dd class="col-sm-9">
                    <pre
                        class="bg-light p-2 rounded"><code>{{ section.section_metadata | tojson(indent=2) if section.section_metadata else 'null' }}</code></pre>
                </dd>

                <dt class="col-sm-3">Created At</dt>
                <dd class="col-sm-9">{{ section.created_at }}</dd>

                <dt class="col-sm-3">Updated At</dt>
                <dd class="col-sm-9">{{ section.updated_at }}</dd>
            </dl>
        </div>
    </div>

    <!-- SQL Editor Form -->
    <div class="card">
        <div class="card-header">
            <h5 class="card-title mb-0">SQL Editor</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('blog.update_section_sql', section_id=section.id) }}">
                <div class="form-group mb-3">
                    <label for="sql_query" class="form-label">SQL Query</label>
                    <textarea id="sql_query" name="sql_query" class="form-control font-monospace" rows="15" required>UPDATE post_section 
SET title = '{{ section.title }}',
    subtitle = '{{ section.subtitle }}',
    content = '{{ section.content | replace("'", "''") }}',
    position = {{ section.position }},
    image_id = {{ section.image_id or 'NULL' }},
    video_url = {{ "'" + section.video_url + "'" if section.video_url else 'NULL' }},
    audio_url = {{ "'" + section.audio_url + "'" if section.audio_url else 'NULL' }},
    content_type = '{{ section.content_type }}',
    duration = {{ section.duration or 'NULL' }},
    keywords = {{ "'" + section.keywords + "'" if section.keywords else 'NULL' }},
    social_media_snippets = {{ section.social_media_snippets | tojson if section.social_media_snippets else 'NULL' }},
    section_metadata = {{ section.section_metadata | tojson if section.section_metadata else 'NULL' }}
WHERE id = {{ section.id }};</textarea>
                </div>
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    Warning: Be careful with SQL queries. Incorrect queries may damage your data.
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">Execute SQL</button>
                    <a href="{{ url_for('blog.edit', slug=section.post.slug) }}" class="btn btn-secondary">Back to
                        Post</a>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    pre code {
        white-space: pre-wrap;
    }

    textarea.form-control {
        font-family: monospace;
        tab-size: 4;
    }
</style>
{% endblock %}