{% extends "base.html" %}

{% block title %}Latest Posts{% endblock %}

{% block content %}
<div class="blog-posts">
    <header class="blog-header">
        <h1>Latest Posts</h1>
        <a href="{{ url_for('blog.create') }}" class="create-post-btn">Create New Post</a>
    </header>

    {% if posts %}
    <div class="posts-grid">
        {% for post in posts %}
        <article class="post-card">
            <div class="post-card__image">
                {% if post.header_image and post.header_image.path %}
                <img src="{{ url_for('static', filename=post.header_image.path) }}"
                    alt="{{ post.header_image.alt_text }}" class="post-thumbnail">
                {% else %}
                <div class="post-thumbnail post-thumbnail--placeholder">
                    <span>No Image Available</span>
                </div>
                {% endif %}
            </div>
            <div class="post-card__content">
                <header class="post-card__header">
                    <h2 class="post-title">
                        <a href="{{ url_for('blog.post', slug=post.slug) }}">{{ post.title }}</a>
                    </h2>
                    {% if post.subtitle %}
                    <p class="post-subtitle">{{ post.subtitle }}</p>
                    {% endif %}
                </header>

                <div class="post-meta">
                    <time datetime="{{ post.updated_at.isoformat() }}">
                        Updated {{ post.updated_at.strftime('%B %d, %Y') }}
                    </time>
                    {% if post.author %}
                    <span class="post-meta__separator">|</span>
                    <span class="post-meta__author">By {{ post.author.name }}</span>
                    {% endif %}
                </div>

                {% if post.description %}
                <p class="post-description">{{ post.description | truncate(150) }}</p>
                {% elif post.summary %}
                <p class="post-description">{{ post.summary | truncate(150) }}</p>
                {% endif %}

                <div class="post-actions">
                    <a href="{{ url_for('blog.post', slug=post.slug) }}" class="read-more">Read More</a>
                    <div class="admin-actions">
                        <a href="{{ url_for('blog.edit', slug=post.slug) }}" class="edit-btn">Edit</a>
                        {% if not post.published %}
                        <form action="{{ url_for('blog.publish', slug=post.slug) }}" method="POST" class="inline">
                            <button type="submit" class="publish-btn">Publish</button>
                        </form>
                        {% else %}
                        <form action="{{ url_for('blog.unpublish', slug=post.slug) }}" method="POST" class="inline">
                            <button type="submit" class="unpublish-btn">Unpublish</button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </article>
        {% endfor %}
    </div>

    {% if posts.has_prev or posts.has_next %}
    <nav class="pagination">
        {% if posts.has_prev %}
        <a href="{{ url_for('blog.latest', page=posts.prev_num) }}" class="prev-page">&larr; Previous</a>
        {% endif %}

        <span class="current-page">Page {{ posts.page }} of {{ posts.pages }}</span>

        {% if posts.has_next %}
        <a href="{{ url_for('blog.latest', page=posts.next_num) }}" class="next-page">Next &rarr;</a>
        {% endif %}
    </nav>
    {% endif %}

    {% else %}
    <div class="no-posts">
        <p>No posts found.</p>
        <a href="{{ url_for('blog.create') }}" class="create-post-btn">Create Your First Post</a>
    </div>
    {% endif %}
</div>
{% endblock %}