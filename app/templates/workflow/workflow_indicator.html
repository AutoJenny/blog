{% macro process_indicator(substages, stages, current_substage) %}
<div class="w-full flex flex-col items-center mb-8">
  <nav aria-label="Workflow" class="w-full">
    <ol class="flex flex-row flex-wrap justify-center w-full gap-0">
      {% set stage_bg = ['bg-[#20243a]', 'bg-[#23273a]', 'bg-[#181c2a]'] %}
      {% set stage_accent = ['indigo', 'blue', 'yellow'] %}
      {% set sub_idx = 0 %}
      {% for stage in stages %}
      {% set bg = stage_bg[loop.index0 % stage_bg|length] %}
      {% set accent = stage_accent[loop.index0 % stage_accent|length] %}
      {% set stage_subs = substages|selectattr('stage_id', 'equalto', stage.id)|list %}
      <div
        class="flex flex-row items-center px-2 py-2 {{ bg }} rounded-xl shadow-sm border border-[#31364a] mx-1 min-w-0">
        {% for sub in stage_subs %}
        <li class="flex flex-col items-center min-w-0">
          <a href="{{ sub.url }}" class="flex items-center justify-center w-12 h-12 rounded-full border-2 transition-colors
                                {% if sub.id == current_substage %}
                                    bg-{{ accent }}-600 border-{{ accent }}-400 text-white shadow-lg
                                {% else %}
                                    bg-[#23273a] border-{{ accent }}-700 text-{{ accent }}-200 hover:bg-{{ accent }}-800 hover:text-white
                                {% endif %}
                                focus:outline-none focus:ring-2 focus:ring-{{ accent }}-400"
            aria-current="{% if sub.id == current_substage %}step{% endif %}" style="touch-action: manipulation;">
            <i class="fa {{ sub.icon }} text-lg"></i>
          </a>
          <span class="mt-1 text-xs font-semibold text-{{ accent }}-300 truncate max-w-[5rem]">{{ sub.label }}</span>
        </li>
        {% if not loop.last %}
        <span class="w-6 h-1 bg-{{ accent }}-500 mx-1 my-3 rounded"></span>
        {% endif %}
        {% set sub_idx = sub_idx + 1 %}
        {% endfor %}
      </div>
      {% if not loop.last %}
      <span
        class="w-8 h-1 bg-gradient-to-r from-{{ accent }}-500 to-{{ stage_accent[(loop.index0+1) % stage_accent|length] }}-500 mx-2 rounded"></span>
      {% endif %}
      {% endfor %}
    </ol>
  </nav>
</div>
{% endmacro %}