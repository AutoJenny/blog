<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Product Posts - Blog Launchpad</title>
    <!-- Tailwind CSS for header -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/launchpad.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/syndication.css') }}">
    
    <!-- Page Data for JavaScript -->
    <script>
        window.pageData = {
            platform: {{ platform | tojson }},
            channel_type: {{ channel_type | tojson }}
        };
    </script>
</head>
<body>
    {% include 'shared/header.html' %}
    
    <div class="container">
        <!-- Breadcrumb Navigation -->
        {% include 'launchpad/includes/breadcrumb.html' %}
        
        <div class="header">
            <h1>üõçÔ∏è Product Posts</h1>
            <p>Automated daily Facebook posts featuring Clan.com products</p>
        </div>
        
        <!-- Item Selection Section -->
        {% include 'launchpad/includes/item_selection.html' %}
        
        <!-- AI Content Generation Section -->
        {% include 'launchpad/includes/ai_content_generation.html' %}
        
        <!-- Posting Control Section -->
        {% include 'launchpad/includes/posting_control.html' %}
        
        <!-- Posting Queue Section -->
        {% include 'launchpad/includes/posting_queue.html' %}
    </div>

    <!-- State Manager (must be loaded first) -->
    <script src="{{ url_for('static', filename='js/state-manager.js') }}"></script>
    
    <!-- Item Selection JavaScript Modules -->
    <script src="{{ url_for('static', filename='js/item-selection-utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/item-selection-data.js') }}"></script>
    <script src="{{ url_for('static', filename='js/item-selection-browser.js') }}"></script>
    <script src="{{ url_for('static', filename='js/item-selection-selection.js') }}"></script>
    <script src="{{ url_for('static', filename='js/item-selection-accordions.js') }}"></script>
    <script src="{{ url_for('static', filename='js/item-selection-core.js') }}"></script>
    
    <!-- Queue Manager JavaScript -->
    <script src="{{ url_for('static', filename='js/queue-manager.js') }}"></script>
    
    <!-- Posting Control JavaScript -->
    <script src="{{ url_for('static', filename='js/posting-control.js') }}"></script>
    
    <!-- AI Content Generation JavaScript Modules -->
    <script src="{{ url_for('static', filename='js/ai-content-generation-core.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai-content-generation-events.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai-content-generation-content.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai-content-generation-data.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai-content-generation-prompts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ai-content-generation-utils.js') }}"></script>
    
    <!-- URL Parameter Handling for Edit Functionality -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check for URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const expand = urlParams.get('expand');
            const highlight = urlParams.get('highlight');
            const action = urlParams.get('action');
            
            if (expand === 'posting-queue' && highlight && action === 'edit') {
                console.log('Edit mode activated for item:', highlight);
                
                // Wait for queue manager to be initialized
                setTimeout(() => {
                    // Expand the posting queue section
                    const postingQueueAccordion = document.querySelector('[data-accordion="posting-queue"]');
                    if (postingQueueAccordion) {
                        const toggleBtn = postingQueueAccordion.querySelector('.accordion-toggle');
                        if (toggleBtn && postingQueueAccordion.classList.contains('collapsed')) {
                            toggleBtn.click();
                        }
                    }
                    
                    // Highlight the specific item
                    setTimeout(() => {
                        highlightQueueItem(parseInt(highlight));
                    }, 500);
                }, 1000);
            }
        });
        
        function highlightQueueItem(itemId) {
            // Find the queue item row
            const queueTableBody = document.getElementById('queue-table-body');
            if (!queueTableBody) return;
            
            const rows = queueTableBody.querySelectorAll('tr');
            let targetRow = null;
            
            // Look for the row containing the item
            rows.forEach(row => {
                const deleteBtn = row.querySelector(`button[onclick*="deleteQueueItem(${itemId})"]`);
                if (deleteBtn) {
                    targetRow = row;
                }
            });
            
            if (targetRow) {
                // Add highlight styling
                targetRow.style.backgroundColor = '#1e40af';
                targetRow.style.border = '2px solid #3b82f6';
                targetRow.style.borderRadius = '8px';
                
                // Scroll to the item
                targetRow.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // Add a pulsing effect
                targetRow.style.animation = 'pulse 2s infinite';
                
                // Remove highlight after 5 seconds
                setTimeout(() => {
                    targetRow.style.backgroundColor = '';
                    targetRow.style.border = '';
                    targetRow.style.borderRadius = '';
                    targetRow.style.animation = '';
                }, 5000);
                
                console.log('Highlighted queue item:', itemId);
            } else {
                console.log('Queue item not found for highlighting:', itemId);
            }
        }
        
        // Add CSS for pulse animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
                70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
                100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>