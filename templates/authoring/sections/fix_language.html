{% extends 'base.html' %}

{% block css_assets %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/llm-module.css') }}">
{% endblock %}

{% block title %}Fix Language - Section Authoring{% endblock %}

{% block content %}
<!-- Set page context for navigation highlighting -->
<script>
    window.currentStage = 'authoring';
    window.currentSubstage = 'fix-language';
    window.postId = {{ post_id|default('null') }};
</script>

<!-- Include condensed header -->
{% include 'planning/includes/condensed_header.html' %}

<script>
// Move authoring content to process-tab after page loads
document.addEventListener('DOMContentLoaded', function() {
    const authoringContent = document.querySelector('.authoring-workspace');
    const processTab = document.getElementById('process-tab');
    if (authoringContent && processTab) {
        processTab.appendChild(authoringContent);
    }
});
</script>

<!-- Authoring Workspace -->
<div class="authoring-workspace">
    <div class="workspace-container">
        <!-- Left Panel: Sections List -->
        <div class="sections-panel">
            <div class="panel-header">
                <h3>Sections</h3>
                <div class="section-controls">
                    <button class="btn-secondary" id="select-all-btn">Select All</button>
                    <button class="btn-primary" id="batch-generate-btn">Fix All</button>
                </div>
            </div>
            
            <div class="section-filters">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="draft">Draft</button>
                <button class="filter-btn" data-filter="complete">Complete</button>
                <button class="filter-btn" data-filter="needs-review">Needs Review</button>
            </div>
            
            <div class="sections-list" id="sections-list">
                <!-- Sections will be loaded here -->
            </div>
        </div>

        <!-- Right Panel: Main Content Area -->
        <div class="content-panel">
            <div class="content-header">
                <h2 id="section-title">Select a Section</h2>
                <span class="section-status" id="section-status"></span>
            </div>
            
            <div class="content-body">
                <!-- Input Data Panel -->
                <div class="input-data-panel">
                    <div class="panel-header">
                        <h5>Input Data</h5>
                    </div>
                    <div class="panel-content">
                        <div class="context-group">
                            <h5 class="context-header">Post Context</h5>
                            <div class="context-item">
                                <strong>Selected Idea:</strong> <span id="selected-idea"></span>
                            </div>
                            <div class="context-item">
                                <strong>Expanded Idea:</strong> <span id="expanded-idea"></span>
                            </div>
                        </div>
                        <div class="context-group">
                            <h5 class="context-header">Section Context</h5>
                            <div class="context-item">
                                <strong>Section Title:</strong> <span id="section-context-title"></span>
                            </div>
                            <div class="context-item">
                                <strong>Section Subtitle:</strong> <span id="section-context-subtitle"></span>
                            </div>
                            <div class="context-item">
                                <strong>Current Draft:</strong> <div id="current-draft-content" class="draft-preview"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LLM Module for Fix Language -->
                {% include 'includes/llm_module.html' %}

                <!-- Generated Fix Language Output -->
                <div class="output-panel">
                    <div class="panel-header">
                        <h5>Fixed Content</h5>
                        <button class="btn-secondary btn-sm" id="save-fixes-btn">Save Fixes</button>
                    </div>
                    <div class="panel-content">
                        <textarea id="generated-fixes" class="form-control" rows="10" placeholder="Fixed content will appear here..."></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/authoring/authoring-manager.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const authoringManager = new AuthoringManager(window.postId, 'fix-language');
    authoringManager.init();
});
</script>
{% endblock %}
